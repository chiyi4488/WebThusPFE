---
layout: default
title: 租借資訊
permalink: /order/
---

<h3 style="font-weight: 700;">租借資訊
    <hr>
</h3>
<div class="row justify-content-center">
    <div class="col-lg-12">
        <table class="table">
            <thead>
                <tr>
                    <th scope="col">租借日期</th>
                    <th scope="col">租借時段</th>
                    <th scope="col">項目</th>
                    <th scope="col">狀態</th>
                    <th scope="col">操作</th>
                </tr>
            </thead>
            <tbody id="rentInfoTableBody">
                <!-- 新增的租借資訊會顯示在這裡 -->
            </tbody>
        </table>
    </div>
</div>
<script>
    // order
    $(document).ready(function () {
        const rentInfoKey = 'rentInfoList';

        function loadRentInfo() {
            const rentInfoList = JSON.parse(localStorage.getItem(rentInfoKey)) || [];
            const tbody = $('#rentInfoTableBody');
            tbody.empty();
            rentInfoList.forEach((info, index) => {
                const statusBadge = getStatusBadge(info.status, info.date);
                const actionButton = getActionButton(info.status, info.date, index);
                const row = `
                <tr data-index="${index}">
                    <td>${info.date}</td>
                    <td>${info.timeSlots.join(', ')}</td>
                    <td>${info.item}</td>
                    <td>${statusBadge}</td>
                    <td>${actionButton}</td>
                </tr>
            `;
                tbody.append(row);
            });
        }

        function getActionButton(status, date, index) {
            let actionButton = '';
            switch (status) {
                case '尚未繳費':
                    actionButton = `<button type="button" class="btn btn-danger btn-sm" onclick="deleteRecord(${index})" data-mdb-ripple-init>取消預約</button>`;
                    break;
                case '預約成功':
                    actionButton = `<button type="button" class="btn btn-danger btn-sm" onclick="deleteRecord(${index})" data-mdb-ripple-init>取消預約</button>`;
                    break;
                case '繳費逾期':
                    actionButton = `<button type="button" class="btn btn-warning btn-sm" onclick="window.location.href='/payment?time=${date}'" data-mdb-ripple-init>立即繳費</button>`;
                    break;
                case '已經取消':
                    actionButton = '';
                    break;
            }
            return actionButton;
        }

        function getStatusBadge(status, date) {
            let badgeClass = '';
            let badgeText = '';
            switch (status) {
                case '尚未繳費':
                    badgeClass = 'badge-warning';
                    badgeText = `<a class="link-warning" href="/payment?time=${date}">尚未繳費</a>`;
                    break;
                case '預約成功':
                    badgeClass = 'badge-primary';
                    badgeText = '預約成功';
                    break;
                case '繳費逾期':
                    badgeClass = 'badge-danger';
                    badgeText = '繳費逾期';
                    break;
                case '已經取消':
                    badgeClass = 'badge-secondary';
                    badgeText = '已經取消';
                    break;
            }
            return `<span class="badge ${badgeClass}" style="font-size: 14px;">${badgeText}</span>`;
        }

        window.deleteRecord = function (index) {
            const rentInfoList = JSON.parse(localStorage.getItem(rentInfoKey)) || [];
            if (confirm('點選 [確定取消] 後，系統即會撤銷您的預約，並依照付款方式進行退費。\n\n如未付款，則逕行取消。確定要繼續執行嗎？')) {
                rentInfoList[index].status = '已經取消';
                localStorage.setItem(rentInfoKey, JSON.stringify(rentInfoList));
                loadRentInfo();
            }
        };

        loadRentInfo();
    });
</script>